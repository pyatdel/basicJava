<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<button>CSV</button>	
	<button>JSON</button>	
	<button>XML</button>	
	<div></div>

<script>
	let btns = document.querySelectorAll('button')
	
	//CSVì •ë³´ AJAXë¡œ ê°€ì ¸ì˜¤ê¸°
	btns[0].addEventListener('click',function(){
		
		//1ê°ì²´ ìƒì„± >> XMLHttpRequest
		let req = new XMLHttpRequest();
		//2ìš”ì²­ ì„¤ì • >> open(method, url, async)
		req.open('get','./sample/data.csv',true);
		//4ì‘ë‹µ ë°›ê¸° >> onreadystatechange ì½˜ì†”ì—ì„œ data.csvì •ë³´ í™•ì¸í•˜ê¸°
		req.onreadystatechange = function(){
			if(req.readyState == 4 && req.status == 200){
<!--				console.log(req.responseText);-->
				f_csv(req.responseText);
			}
		};
		//3ìš”ì²­ ì „ë‹¬ >> send()
		//3ë²ˆë³´ë‹¤ 4ë²ˆì´ ë” ë¨¼ì € ì‘ì„±ë˜ëŠ” ì´ìœ ëŠ” 
		// ìš”ì²­ì´ ìˆœì‹ê°„ì— ì§„í–‰ë˜ì–´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë³´ë‹¤ ì½”ë“œ ë°˜í™˜ì´ ë” ë¹ ë¥¼ ê²½ìš°,
		// ì½”ë“œì˜ ìœ ì‹¤ì„ ë§‰ê¸°ìœ„í•´ ë¨¼ì € 4ë²ˆ í•­ëª©ì„ ì™„ì„±í•˜ê³  ì•ˆì „í•˜ê²Œ ì½”ë“œê°’ì„ ë°›ì•„ì•¼ í•¨
		req.send();
	});
	
	function f_csv(p_csv){
		//console.log(">>> ", p_csv);
		
		//ì •ë³´ë¥¼ ì½¤ë§ˆë¡œ ë‚˜ëˆ„ì–´ í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
		let v_tbl = "<table border='1'>";
		
		//í•œ ì¤„ì”© ì •ë³´ ë‚˜ëˆ„ê¸° - split(êµ¬ë¶„ì)ë¡œ ë¬¸ìì—´ì„ ë°°ì—´ë¡œ ë°˜í™˜ë°›ìŒ
		let lines = p_csv.split("\r\n");
		
		for(let i=0; i<lines.length; i++){
			v_tbl += `<tr>`;
				
			//ê° ì¹¸ì˜ ì •ë³´ë¡œ ë‚˜ëˆ„ê¸° - 
			let cells = lines[i].split(",");
			
			for(let j=0; j<cells.length; j++){
				if(i<1){
					v_tbl += `<th>${cells[j]}</th>`;
				}else{
					v_tbl += `<td>${cells[j]}</td>`;
				}
			}
			
			v_tbl += `</tr>`;
		}
		v_tbl += "</table>";
		
		document.querySelector('div').innerHTML = v_tbl;
	}
	
	//JSONì •ë³´ AJAXë¡œ ê°€ì ¸ì˜¤ê¸°
	btns[1].addEventListener('click',function(){
		//1 ê°ì²´ ìƒì„±
		let ajax = new XMLHttpRequest();
		//2 ìš”ì²­ ì„¤ì •
		ajax.open('get','sample/data.json');
		//4 ì‘ë‹µ ë°›ê¸°
		ajax.onreadystatechange = function(){
			if(ajax.readyState==4&&ajax.status==200){
				console.log( typeof ajax.responseText);
				let jsonData = JSON.parse(ajax.responseText); //jsonë¬¸ìì—´>>jsê°ì²´ë¡œ ë³€í™˜
				f_json(jsonData);
			}
		}; 
		//3 ìš”ì²­ ì „ë‹¬
		ajax.send();
	});
	
	let f_json = function(p_json){
		//console.log(">>>>>>", p_json);
		
		//í…Œì´ë¸”ë¡œ ìµœì¢… ê²°ê³¼ ì¶œë ¥í•˜ê¸°
		let v_tbl = "<table border=1>";
			
		//ì „ë‹¬ëœ ê°ì²´ì—ì„œ keyì •ë³´ë§Œ ì¶”ì¶œí•´ë³´ì
		let objKey = Object.keys(p_json[2]); //4ê°ì²´ë“¤ ì¤‘ í•œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ keyì •ë³´ë§Œ ë°°ì—´ë¡œ ë°›ìŒ
			
		//v_tbl += "<tr><th>" + objKey[0] + "</th><th>" + objKey[1] + "</th><th>" + objKey[2] + "</th></tr>";
		v_tbl += `<tr><th>${objKey[0]}</th><th>${objKey[1]}</th><th>${objKey[2]}</th></tr>`;
			
		for(let i=0; i<p_json.length; i++){
			v_tbl += "<tr>";
				
			v_tbl += "<td>" + p_json[i].name + "</td>";
			v_tbl += `<td>ğŸ¥¨${p_json[i].type}</td>`;
			v_tbl += "<td>" + p_json[i].alias + "</td>";
			
			v_tbl += "</tr>";
		}
		
		v_tbl += "</table>";
		
		document.querySelector('body').insertAdjacentHTML("beforeend",v_tbl);
	}
	
	//XMLì •ë³´ AJAXë¡œ ê°€ì ¸ì˜¤ê¸°
	btns[2].addEventListener('click',function(){
		
		//ê°ì²´ ìƒì„±
		let req = new XMLHttpRequest();
		//ìš”ì²­ ì„¤ì •
		req.open('get','./sample/data.xml',true);
		//ì‘ë‹µ ë°›ê¸°
		req.addEventListener('readystatechange',function(){
			if(this.readyState == 4 && this.status == 200){
				let xmlData = this.responseXML; //?
				//console.log(xmlData.querySelectorAll('friend'));
				f_xml(xmlData);
			}
		});
		//ìš”ì²­ ì „ë‹¬
		req.send();
	});
	
	let f_xml = (p_xml) => {
		let v_friends = p_xml.querySelectorAll('friend');
		
		console.log( v_friends[0].children[0].firstChild);
		
		let v_tbl = "<table border=1>";
		
		v_tbl += "<tr><th colspan='3'>ë½€ë¡œë¡œ ì¹œêµ¬ë“¤</th></tr>";
		v_tbl += "<tr><th>" + v_friends[0].children[0].tagName
			+ "</th><th>" + v_friends[0].children[1].tagName 
			+ "</th><th>" + v_friends[0].children[2].tagName 
			+ "</th></tr>";
		
		for(let i=0; i<v_friends.length; i++){
			v_tbl += "<tr>";
			
			let child = v_friends[i].children;
			for(let j=0; j<child.length; j++){
				v_tbl += `<td>${child[j].innerHTML}</td>`;
			}
			
			v_tbl += "</tr>";
		}
		v_tbl += "</table>";
		
		document.querySelector('body').innerHTML = v_tbl;
	};
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</script>
</body>
</html>